<html>
<head><title>
H5recover Tool Specification
</title></head>

<body>


<hr>
<dl>

  <dt><div align=right><font color=999999 size=-1><i>
      Last modified: 29 December 2011
      </i></font></div>

  <dt><strong>Tool Name:</strong> <a name="Tools-Recover">h5recover</a>
  <dt><strong>Syntax:</strong>
    <dd><code>h5recover
        -j <em>journal_file.jnl</em>
        [-h]
        [-v] 
        [-b <em>backup_name</em>]
        [-s] 
        [-n] 
        <em>hdf5_file.h5</em></code>

  <p>
  <dt><strong>Purpose:</strong>
    <dd>Recovers a corrupted HDF5 file that crashed while journaling 
        was enabled.

  <p>
  <dt><strong>Motivation:</strong>
    <dd><code>h5recover</code> is part of HDF5&rsquo;s metadata journaling
      feature, which guards against metadata corruption and provides a
      recovery capability.
      <p>
      Metadata journaling is discussed more fully in the <cite>HDF5 Reference
      Manual</cite> entries cited below (in &ldquo;See Also&rdquo;),
      &ldquo;<a href="../RG/CrashSurvival.html">Using HDF5&rsquo;s 
      Metadata Journaling and File Recovery Features</a>,&rdquo; and
      &ldquo;<a href="../RG/Metadata_Journaling,Crash_Survivability.pdf">Metadata  
      Journaling to Improve Crash Survivability</a>.&rdquo;

  <p>
  <dt><strong>Description:</strong>
    <dd><code>h5recover</code> is a command line tool that walks through a 
        the journal file specified in <em>journal_file.jnl</em> to
        rebuild the corrupted HDF5 file specified in <em>hdf5_file.h5</em>.
        <p>
        <code>h5recover</code> is deisigned for use only when all of
        the following are true:
        <ul>
            <li>An event has occured that caused an HDF5 file to be 
                abandoned without being closed properly.
                An application or system crash would be an example of 
                such an event.
            <li>Metadata journaling was set for the file at the time of
                the event.  (See <code>H5Fset_jnl_config</code>,
                <code>H5Pset_jnl_config</code>, and 
                &ldquo;Using HDF5&rsquo;s Metadata Journaling and File 
                Recovery Features.&rdquo;)
        </ul>
        <p>
        In such circumstances, the most recent metadata updates 
        are expected to be missing in the abandoned HDF5 file.
        <code>h5recover</code> expects to find those metadata changes 
        recorded as metadata image journal entries in the journal file 
        <em>journal_file.jnl</em>.
        <code>h5recover</code> will decode those metadata images and 
        write the metadata updates to the HDF5 file <em>hdf5_file.h5</em>.
        Normally, this operation will restore the corrupted HDF5 file
        to a usable state. 

  <p>
  <dt><strong>Notes:</strong>
    <dd>It is the user&rsquo;s or the application&rsquo;s responsibility 
        to make sure that the following are true. 
        <code>h5recover</code> does not check and one should assume that
        a mismatch will result in a permanently unrecoverable HDF5 file:
        <ul>
            <li><em>hdf5_file.h5</em> is corrupted and needs to be recovered.
            <li><em>journal_file.jnl</em> is the correct journal file 
                for <em>hdf5_file.h5</em>.
        </ul>
        <p>
        When creating a backup file, <code>h5recover</code> overwrites 
        a file of the same name without warning.
        <p>
        <code>h5recover</code> recovers only missing metadata updates; 
        a different approach is required to ensure raw data preservation.

  <p>
  <dt><strong>Objects:</strong>
    <dd><dl>
        <dt><code>-j</code> <em>journal_file.jnl</em> 
            <dd>Specifies the input journal file, which will provide
                the missing metadata updates.
        <dt><em>hdf5_file.h5</em>
            <dd>Specifies the HDF5 file to be recovered.
    </dl>

  <p>
  <dt><strong>Options and Parameters:</strong>
    <dd><dl>
        <dt><code>-h, --help</code>
            <dd>Print information regarding this command.
        <dt><code>-v, --verbose</code>
            <dd>Generate more verbose output.
        <dt><code>-b, --backup</code> <em>backup_name</em>
            <dd>Specify a name for the backup copy of the HDF5 file.
                <br>
                Default: <code><em>hdf5_file.h5</em>.backup</code>
        <dt><code>-s, --version</code>
            <dd>Print tool version number and exit.
        <dt><code>-n, --nocopy</code>
            <dd>Do not create a backup copy before recovery.
    </dl>

  <p>
  <dt><strong>See Also:</strong>
    <dd><a href="H5Fset_jnl_config.html"><code>H5Fset_jnl_config</code></a>,
        &nbsp;
        <a href="H5Fget_jnl_config.html"><code>H5Fget_jnl_config</code></a>, 
        &nbsp;
        <a href="H5Pset_jnl_config.html"><code>H5Pset_jnl_config</code></a>, 
        &nbsp;
        <a href="H5Pget_jnl_config.html"><code>H5Pget_jnl_config</code></a>,
        <p>
        <a href="H5AC_jnl_config_t.html"><code>H5AC_jnl_config_t</code></a>
<!--
        <p>
        <a href="h5recover.html"><code>h5recover</code></a>
-->
        <p>
        &ldquo;<a href="../RG/CrashSurvival.html">Using HDF5&rsquo;s 
          Metadata Journaling and File Recovery Features</a>&rdquo;
        <br>
        &ldquo;<a href="../RG/Metadata_Journaling,Crash_Survivability.pdf">Metadata
          Journaling to Improve Crash Survivability</a>&rdquo; 

  <p>
  <dt><strong>Assumptions and Caveats:</strong>
    <dd>The following assumptions and caveats should eventually be addressed 
        via options or checks within the tool itself, but initial stages of 
        development require that they be explicitly stated:
        <ul>
          <li>h5recover assumes that the input HDF5 file is corrupt and needs
              to be recovered.
          <li>It is up to the user to provide the correct combination of 
              HDF5 and journal files.  
              h5recover assumes that the journal file provided was generated
              from the HDF5 file provided and a mismatch can be expected 
              to result in a permanently unrecoverable HDF5 file.
          <li>Recovery occurs in-place, with a back-up copy of specified name
              generated beforehand. There is currently no option to generate
              a new recovered file while keeping the original intact.
          <li>Backup files created by <code>h5recover</code> will currently 
              overwrite files of the same name without issuing a warning.
        </ul>

  <p>
  <dt><strong>History:</strong>
    <dd><table width="90%">
        <tr>
          <td valign="top" align="left" width="10%">
            <strong>Release</strong>&nbsp;&nbsp;&nbsp;&nbsp;</td>
          <td valign="top" align="left">
            <strong>Change</strong></td></tr>
        <tr>
          <td valign="top">1.10.0</td>
          <td valign="top">
            Command-line utility introduced in this release.</td></tr>
    </table>
</dl>

</body>
</html>
