\tikzstyle{textBox}    = [rectangle, text centered, font=\sffamily\footnotesize\bfseries]
\tikzstyle{fileBox}    = [draw, rectangle, fill=white]
\tikzstyle{headerBox}  = [draw, rectangle, fill=white, font=\sffamily\footnotesize]
\tikzstyle{dataBox}    = [draw, rectangle, thick, fill=white, pattern color=rulecolor, pattern=dots, font=\sffamily\small]
\tikzstyle{indexBox}   = [draw, rectangle, thick, fill=white, pattern color=rulecolor, pattern=north west lines, font=\sffamily\small]

\tikzstyle{cacheBox}   = [draw, rectangle, thick, fill=black!10, drop shadow={opacity=0.25}]

\tikzstyle{message} = [draw=rulecolor, very thick, shorten <=2pt, shorten >=2pt, 
  text centered, text width=2.5cm, font=\footnotesize]
\tikzstyle{capt} = [text centered, font=\sffamily\footnotesize\bfseries, above=3mm]

\begin{tikzpicture}

\node[rectangle, minimum width=14cm] (app) {};
\node[rectangle, minimum height=3.6cm, minimum width=6.4cm, right=2mm of app.west] (cache) {};

\node[textBox, minimum width=2.5cm, minimum height=0.7cm, right=2mm of cache.west, text width=3cm] (cache1) {Dataset header (\texttt{idx\_info} message)};
\node[headerBox, minimum width=2.5cm, below=-1pt of cache1] (cache2) {\dots};
\node[headerBox, minimum width=2.5cm, below=-1pt of cache2] (cache3) {Plugin ID};
\node[headerBox, minimum width=2.5cm, below=-1pt of cache3] (cache4) {Metadata Size};
\node[headerBox, minimum width=2.5cm, below=-1pt of cache4] (cache5) {Metadata};
\node[headerBox, minimum width=2.5cm, below=-1pt of cache5] (cache6) {\dots};

\node[rectangle, draw=rulecolor, very thick, fit=(cache1) (cache6)] (cachecol1) {};

\node[fileBox, minimum height=1cm, minimum width=14cm, below=80pt of app] (file) {};
\node[textBox, minimum height=1cm, minimum width=2cm, right=4mm of file.west] (filetitle) {File};
\node[headerBox, fill=rulecolor, thick, minimum height=1cm, minimum width=1cm, right=1.5cm of filetitle] (fileheader) {};
\node[indexBox, minimum height=1cm, minimum width=2cm, right=1cm of fileheader] (index) {};
\node[dataBox, minimum height=1cm, minimum width=4cm, right=1cm of index] (dataset) {};

%\matrix (A) [matrix of math nodes, column sep=0 mm] 
%{ a_{11} & a_{12} & a_{13}  \\
%  a_{21} & a_{22} & a_{23}  \\
%  a_{31} & a_{32} & a_{33}  \\
%  a_{11} & a_{12} & a_{13} \\
%  a_{21} & a_{22} & a_{13}\\
%};

\draw[message, ->] (cachecol1.east) -| (fileheader.north);
\draw[decorate, decoration={brace, raise=2mm}, draw=rulecolor, very thick] (index.north west) to
  node [capt] {Index} (index.north east);
\draw[decorate, decoration={brace, raise=2mm}, draw=rulecolor, very thick] (dataset.north west) to
  node [capt] {Dataset} (dataset.north east);

\end{tikzpicture}
