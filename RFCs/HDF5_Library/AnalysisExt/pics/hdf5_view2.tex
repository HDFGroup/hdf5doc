\tikzstyle{groupBox} = [draw, ellipse, fill=white, minimum size=20pt,
  text centered, font=\sffamily, text width=20pt, inner sep=0]

\tikzstyle{textBox} = [fill=white, inner sep=2pt, text centered, font=\sffamily]

\tikzstyle{link} = [->, thick, >=stealth', shorten <=1pt, shorten >=1pt]

\pgfmathsetseed{1}

\def\drawdataset#1{%
\begin{scope}[#1]
  \foreach \y in {-1.5,-0.5,0.5} {
      \foreach \x in {-2.5,-1.5,-0.5,0.5,1.5} {
          \path[fill=white, draw] (\x,\y) rectangle ++(1,1);
      }
  }
\end{scope}
}

\begin{tikzpicture}

% Root
\node[groupBox] (root) {/};

% Groups
\node[below=50pt of root, inner sep=0] (rootgroup) {};
\node[groupBox, left=80pt of rootgroup] (group0) {};
\node[groupBox, below=100pt of root] (group1) {};
\node[groupBox, right=80pt of rootgroup] (group2) {};

% Datasets
% G0
\node[below=30pt of group0, inner sep=0] (datasetg0) {};
\node[rectangle, text height=25pt, left=45pt of datasetg0, inner sep=0] (tempg0) {};
\drawdataset{shift=(tempg0.south), scale=0.3}
\node[rectangle, text height=25pt, right=45pt of datasetg0, inner sep=0] (presg0) {};
\drawdataset{shift=(presg0.south), scale=0.3}

% G1
\node[below=30pt of group1, inner sep=0] (datasetg1) {};
\node[rectangle, text height=25pt, left=45pt of datasetg1, inner sep=0] (tempg1) {};
\drawdataset{shift=(tempg1.south), scale=0.3}
\node[rectangle, text height=25pt, right=45pt of datasetg1, inner sep=0] (presg1) {};
\drawdataset{shift=(presg1.south), scale=0.3}

% G2
\node[below=30pt of group2, inner sep=0] (datasetg2) {};
\node[rectangle, text height=25pt, left=45pt of datasetg2, inner sep=0] (tempg2) {};
\drawdataset{shift=(tempg2.south), scale=0.3}
\node[rectangle, text height=25pt, right=45pt of datasetg2, inner sep=0] (presg2) {};
\drawdataset{shift=(presg2.south), scale=0.3}

% Links
\draw[link] (root) -- node [textBox] {Timestep1} (group0);
\draw[link] (root) -- node [textBox] {Timestep2} (group1);
\draw[link] (root) -- node [textBox] {Timestep3} (group2);

\draw[link] (group0) -- node [textBox] {Temperature} (tempg0);
\draw[link, draw=rulecolor, text=rulecolor] (group0) -- node [textBox] {Pressure} (presg0);

\draw[link] (group1) -- node [textBox] {Temperature} (tempg1);
\draw[link, draw=rulecolor, text=rulecolor] (group1) -- node [textBox] {Pressure} (presg1);

\draw[link] (group2) -- node [textBox] {Temperature} (tempg2);
\draw[link, draw=rulecolor, text=rulecolor] (group2) -- node [textBox] {Pressure} (presg2);

%node distance=100pt, 

%\pgfmathsetseed{1}
%\foreach \col in {black,red,green,blue}
%{
%\begin{tikzpicture}[x=10pt,y=10pt,ultra thick,baseline,line cap=round]
%\coordinate (current point) at (0,0);
%\coordinate (old velocity) at (0,0);
%\coordinate (new velocity) at (rand,rand);
%\foreach \i in {0,1,...,100}
%{
%\draw[\col!\i] (current point)
%.. controls ++([scale=-1]old velocity) and
%++(new velocity) .. ++(rand,rand)
%coordinate (current point);
%\coordinate (old velocity) at (new velocity);
%\coordinate (new velocity) at (rand,rand);
%}
%\end{tikzpicture}
%}


\end{tikzpicture}
