<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./zlib_files/filelist.xml">
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Albert Cheng</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>Albert Cheng</o:LastAuthor>
  <o:Revision>6</o:Revision>
  <o:TotalTime>270</o:TotalTime>
  <o:Created>2002-04-09T15:44:00Z</o:Created>
  <o:LastSaved>2002-04-18T22:02:00Z</o:LastSaved>
  <o:Pages>3</o:Pages>
  <o:Words>1302</o:Words>
  <o:Characters>7427</o:Characters>
  <o:Company>NCSA</o:Company>
  <o:Lines>61</o:Lines>
  <o:Paragraphs>14</o:Paragraphs>
  <o:CharactersWithSpaces>9120</o:CharactersWithSpaces>
  <o:Version>9.3821</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-font-kerning:0pt;}
h2
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:12.0pt;
	font-family:"Times New Roman";
	font-weight:normal;
	font-style:italic;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	font-size:16.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	font-weight:bold;
	mso-bidi-font-style:italic;}
p.MsoBodyTextIndent, li.MsoBodyTextIndent, div.MsoBodyTextIndent
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.25in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p.HTMLBody, li.HTMLBody, div.HTMLBody
	{mso-style-name:"HTML Body";
	mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-layout-grid-align:none;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:845947934;
	mso-list-type:hybrid;
	mso-list-template-ids:-1240458372 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1
	{mso-list-id:949701921;
	mso-list-type:hybrid;
	mso-list-template-ids:1558844642 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l2
	{mso-list-id:1705137890;
	mso-list-type:hybrid;
	mso-list-template-ids:-1277381212 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l3
	{mso-list-id:2085570737;
	mso-list-type:hybrid;
	mso-list-template-ids:-501574638 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoTitle>Various Zlib Issues</p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:16.0pt;mso-bidi-font-size:12.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h1><span style='font-weight:normal'>This document lists out various Zlib issues
and proposes “solutions” to them.<span style="mso-spacerun: yes">  </span>For
now, this covers Unix systems and the C language API.<span style="mso-spacerun:
yes">  </span>If you know the implication of the issues in other non-Unix
systems, please contribute.<o:p></o:p></span></h1>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><b>How HDF software use zlib<o:p></o:p></b></p>

<ol style='margin-top:0in' start=1 type=1>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list .5in'>HDF4
     library use zlib as one of the compression methods.<span
     style="mso-spacerun: yes">  </span>The HDF4 source code includes the
     source of zlib under directory hdf/zlib.<span style="mso-spacerun: yes"> 
     </span>When HDF4 library is built, it is set to use this version of zlib
     source to build a libz.a for zlib code.<span style="mso-spacerun: yes"> 
     </span>The resultant HDF4 library (libdf.a) is wired to the version of
     zlib in hdf/zlib.</li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list .5in'>HDF5
     library use zlib as the only compression method by default.<span
     style="mso-spacerun: yes">  </span>But HDF5 can be configured without zlib
     support.<span style="mso-spacerun: yes">  </span>The HDF5 source code does
     not include the source of zlib.<span style="mso-spacerun: yes">  </span>It
     expects to use the zlib as an external library.<span style="mso-spacerun:
     yes">  </span>When HDF5 library is built and if zlib option is configured
     in, it uses the version of zlib header and library files as directed in
     the “--with-zlib=…” configure option or whatever is located by the
     compiler command.<span style="mso-spacerun: yes">  </span>The resultant
     HDF5 library (libhdf5.a) is wired to the version of zlib it finds during
     the building.</li>
</ol>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h1>Recent zlib security alert</h1>

<p class=HTMLBody>The GZIP organization(<span style='mso-bidi-font-family:"Courier New"'><a
href="http://www.gzip.org/">http://www.gzip.org</a>) recently issue a security Zlib
advisory.<o:p></o:p></span></p>

<p class=HTMLBody><span style='mso-bidi-font-family:"Courier New"'><span
style="mso-spacerun: yes">     </span><a
href="http://www.gzip.org/zlib/advisory-2002-03-11.txt">http://www.gzip.org/zlib/advisory-2002-03-11.txt</a><o:p></o:p></span></p>

<p class=MsoNormal>It involves a potential security problem due to double free
coding error in versions 1.1.3 or older.<span style="mso-spacerun: yes"> 
</span>V1.1.4 has these error code corrected.<span style="mso-spacerun: yes"> 
</span>Though the security is not serious and is not clear how it can be
exploited, GZIP advises users to upgrade their zlib to v1.1.4. </p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h1>Zlib versions compatibility</h1>

<p class=MsoNormal>If a program code is compiled with one version of zlib.h but
linked with different version of libz.a, it will result in a runtime error when
zlib code is executed.<span style="mso-spacerun: yes">  </span>When such a
condition occurs, the zlib routine returns failure.<span style="mso-spacerun:
yes">  </span>No other actions such as error messages or abort occur.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h1>Issue 1: Should HDF provide the zlib 1.1.4 to users?</h1>

<h2><span style='mso-bidi-font-style:normal'>Zlib source support<o:p></o:p></span></h2>

<p class=MsoNormal>GZIP.ORG provides the source free to anyone.<span
style="mso-spacerun: yes">  </span>HDF should direct users to download the zlib
source from the zlib site, <span style='mso-bidi-font-family:"Courier New"'><a
href="http://www.gzip.org/zlib/">http://www.gzip.org/zlib/</a><o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-family:"Courier New"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h2>Zlib binary support</h2>

<p class=MsoNormal>HDF website used to provide the binary of zlib 1.1.3 for
several platforms that HDF5 library supports.<span style="mso-spacerun: yes"> 
</span>Those binary files are no longer available.<span style="mso-spacerun:
yes">  </span>Elena has compiled zlib v1.1.4 for various machines and is
planning to put them on the HDF download site.<span style="mso-spacerun: yes"> 
</span>The location is not determined yet.</p>

<p class=MsoNormal>GZIP.ORG also provides zlib binary for various platforms at
the same site above.<span style="mso-spacerun: yes">  </span>It would be better
for the HDF site to direct users to download zlib binary from the zlib site and
we will provide zlib binary for platforms that are not available at the zlib
binary site but supported by HDF software.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h1>Issue 2: What are the scenarios if HDF5 library is built with a version of
zlib.h but linked with different version of libz.a?</h1>

<p class=MsoNormal><i>Scenarios 3.1:</i> a user downloads a version of HDF5
library from HDF FTP site but his machine has a different version of
libz.a.<span style="mso-spacerun: yes">  </span>All HDF5 applications he
compiled, using the downloaded HDF5 library, will fail all function involving
zlib compression but everything else works correctly.<span style="mso-spacerun:
yes">  </span>His options are:</p>

<ol style='margin-top:0in' start=1 type=1>
 <li class=MsoNormal style='mso-list:l3 level1 lfo6;tab-stops:list .5in'>download
     HDF5 library source and build a new version of HDF5 library using the
     version of zlib files in his machine.</li>
 <li class=MsoNormal style='mso-list:l3 level1 lfo6;tab-stops:list .5in'>Get hold
     the version of zlib that the HDF5 library is built with and modified the
     linking process to use this particular version of zlib instead the one in
     his system.</li>
 <li class=MsoNormal style='mso-list:l3 level1 lfo6;tab-stops:list .5in'>Replace
     the zlib of his system with the version of zlib the HDF5 library is built
     with.</li>
</ol>

<p class=MsoNormal>Notice that the HDF5 tools (e.g., h5dump) will work
independent of the zlib versions <i>if </i>they have been statically
linked.<span style="mso-spacerun: yes">  </span>That is because the appropriate
version of libz.a code have been linked into the h5dump binary files.<span
style="mso-spacerun: yes">  </span>The external libz.a is not used nor needed
during runtime.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><i style='mso-bidi-font-style:normal'>Scenarios 3.2: </i><span
style='mso-bidi-font-style:italic'>A user downloads a version of HDF5 library
from HDF FTP site and his machine has the same version of libz.a the HDF5
library is built with; or he download the HDF5 source and has built it
according to the zlib files in his machine.<span style="mso-spacerun: yes"> 
</span>Then the zlib library changes to a different version.<span
style="mso-spacerun: yes">  </span>All HDF5 application he compiled after the
zlib change will fail all functions involving zlib compression but everything
else works correctly.<span style="mso-spacerun: yes">  </span>His options are
similar to Scenarios 3.1.<span style="mso-spacerun: yes">  </span>All other
previous compiled code using zlib functions will have the same external library
upgrade problems just like the HDF5 applications.<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'>In summary: we need
to include the version information of zlib we use to build our HDF software for
binary download.<span style="mso-spacerun: yes">  </span>Whatever version of
zlib we use to build the software, it will run into compatibility problem in
some machines.<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h1>Issue 3: Should HDF4 upgrade its zlib source to v1.1.4?</h1>

<p class=MsoNormal>The plan is to not include zlib source as an internal part
of the HDF4 source tree but to treat zlib as an external library just like
other zlib applications.<span style="mso-spacerun: yes">  </span>It will not be
the best use of resource to upgrade the zlib code in the<span
style="mso-spacerun: yes">  </span>hdf/zlib directory.<span
style="mso-spacerun: yes">  </span>Note that zlib is planning a v1.1.5 beta
release soon.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoBodyText>Issue 4: Can our current HDF4 library, which includes zlib
source, avoid all zlib version compatibility problems?</p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'>It depends.<span
style="mso-spacerun: yes">  </span>If a user compiles HDF4 applications with
hard coded library paths such as<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'><span
style="mso-spacerun: yes">    </span>cc prog.c –I$HOME/hdf4/include
$HOME/hdf4/lib/libdf.a $HOME/hdf4/lib/libz.a …<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'>then his a.out file
is insulated from any external zlib versions issue.<span style="mso-spacerun:
yes">  </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'>But if he compile
it with the expectation that the HDF4 software are installed in the regular
system places such as<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'><span
style="mso-spacerun: yes">   </span>cc prog.c -ldf -lz …<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'>then it depens if
there is another version of libz.so around and if it takes precedence over the
version of zlib from the HDF4 library.<span style="mso-spacerun: yes"> 
</span>If that happens, all functions involving zlib compression may fail
mysteriously.<span style="mso-spacerun: yes">  </span>In that case, the user
has to work on the linking sequence to make sure the right version of zlib is
used.<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoBodyText>Issue 5: If we change the HDF4 library to use an external
zlib, would it make the situation worse?</p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'>If a user builds
the current HDF4 library (has zlib code) in his machine, he will have zlib
version compatibility problem if his machine has a zlib version different from
the one HDF4 includes.<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'>If he builds the
new HDF4 library (uses external zlib) in his machine, he will NOT have any zlib
version compatibility problem.<o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-bidi-font-style:italic'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoBodyText>Issue 6: What about a user who uses both HDF4 and HDF5
libraries in the same application?</p>

<p class=MsoBodyText><i><span style='font-weight:normal'>Scenario 6.1: </span></i><span
style='font-weight:normal;mso-bidi-font-style:normal'>If he builds the current
HDF4 library (has zlib code) and HDF5 library in his machine and his machine
has a different version of zlib software, the result will vary, depending on
which copy of zlib is linked in.<span style="mso-spacerun: yes">  </span>If the
libz.a in the HDF4 code is used, then all HDF4 calls to zlib compression will
succeed but all HDF5 calls to zlib compress will fail.<span
style="mso-spacerun: yes">  </span>If the external libz.a is used, then all
HDF4 compression calls fail while all HDF5 calls succeed.<span
style="mso-spacerun: yes">  </span>Quite confusing.<o:p></o:p></span></p>

<p class=MsoBodyText><span style='font-weight:normal;mso-bidi-font-style:normal'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoBodyText><i><span style='font-weight:normal'>Scenario 6.2: </span></i><span
style='font-weight:normal;mso-bidi-font-style:normal'>If he builds the new HDF4
library (uses external zlib) and HDF5 library in his machine, the two built
libraries will work just fine.<o:p></o:p></span></p>

<p class=MsoBodyText><span style='font-weight:normal;mso-bidi-font-style:normal'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoBodyText><span style='mso-bidi-font-style:normal'>Issue 7: What
about upgrading zlib in NCSA machines?<o:p></o:p></span></p>

<p class=MsoBodyText><span style='font-weight:normal;mso-bidi-font-style:normal'>Most,
if not all, NCSA machines have v1.1.3 zlib installed.<span style="mso-spacerun:
yes">  </span>This is the version with the double-free bug but it is not a
serious bug that requires immediate upgrade.<span style="mso-spacerun: yes"> 
</span>For most machines, zlib is installed in the /usr/ncsa hierarchy.<span
style="mso-spacerun: yes">  </span>Couple machines have it installed in
/usr/local/ hierarchy.<span style="mso-spacerun: yes">  </span>The /usr/ncsa is
controlled by system staff though it is not clear who, if anyone, is maintaining
it.<span style="mso-spacerun: yes">  </span>On the other hand, the worst thing
to happen is for us taking things into our own hand by installing an extra copy
of zlib software in our areas such as the /usr/sdt hierarchy.<span
style="mso-spacerun: yes">  </span>The disadvantages of doing such are:<o:p></o:p></span></p>

<p class=MsoBodyText style='margin-left:.5in;text-indent:-.25in;mso-list:l1 level1 lfo8;
tab-stops:list .5in'><![if !supportLists]><span style='font-weight:normal;
mso-bidi-font-style:normal'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-weight:normal;mso-bidi-font-style:
normal'>Multiple version of zlib in the same machine causing confusions.<span
style="mso-spacerun: yes">  </span>One would have to figure out the correct
version to compile and link.<span style="mso-spacerun: yes">  </span>The
benefit in return is nothing concrete.<o:p></o:p></span></p>

<p class=MsoBodyText style='margin-left:.5in;text-indent:-.25in;mso-list:l1 level1 lfo8;
tab-stops:list .5in'><![if !supportLists]><span style='font-weight:normal;
mso-bidi-font-style:normal'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-weight:normal;mso-bidi-font-style:
normal'>If we build with a version of zlib in our own machines while the rest
of NCSA uses a different version, all binary built is not usable for those
other machines.<span style="mso-spacerun: yes">  </span>Again, this creates
compatibility problems with no concrete benefit.<o:p></o:p></span></p>

<p class=MsoBodyText><span style='font-weight:normal;mso-bidi-font-style:normal'>It
is better to ask system staff to upgrade the zlib software so that all hosts of
the same platform will move to a new version at the same time, thus eliminating
the version compatibility problem.<o:p></o:p></span></p>

<p class=MsoBodyText><span style='font-weight:normal;mso-bidi-font-style:normal'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoBodyText><span style='mso-bidi-font-style:normal'>Recommendations:<o:p></o:p></span></p>

<p class=MsoBodyText style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo10;
tab-stops:list .5in'><![if !supportLists]><span style='font-weight:normal;
mso-bidi-font-style:normal'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-weight:normal;mso-bidi-font-style:
normal'>Setup pointers on our HDF website to direct users to go to http://www.gzip.org/zlib
for both source and binary download of zlib software.<span style="mso-spacerun:
yes">  </span>We will supplement with zlib binary for platforms that HDF software
supported but not provided by the zlib site.<o:p></o:p></span></p>

<p class=MsoBodyText style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo10;
tab-stops:list .5in'><![if !supportLists]><span style='font-weight:normal;
mso-bidi-font-style:normal'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-weight:normal;mso-bidi-font-style:
normal'>Change HDF4 to use external zlib library.<span style="mso-spacerun:
yes">  </span>(May do the same for jpeg library but that is an orthogonal
issue.)<o:p></o:p></span></p>

<p class=MsoBodyText style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo10;
tab-stops:list .5in'><![if !supportLists]><span style='font-weight:normal;
mso-bidi-font-style:normal'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-weight:normal;mso-bidi-font-style:
normal'>Request helpdesk to upgrade all zlib software to the newer
version.<span style="mso-spacerun: yes">  </span>May offer to assist them in
acquiring or building the binary.<o:p></o:p></span></p>

<p class=MsoBodyTextIndent style='margin-left:0in'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoBodyTextIndent style='margin-left:0in'>===</p>

<p class=MsoBodyTextIndent style='margin-left:0in'><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt'>Revision: April 18, 2002<o:p></o:p></span></p>

<p class=MsoBodyTextIndent style='margin-left:0in'><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt'>Email: acheng@ncsa.uiuc.edu<o:p></o:p></span></p>

</div>

</body>

</html>
