<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./file-close-proposal_files/filelist.xml">
<link rel=Edit-Time-Data href="./file-close-proposal_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:128;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-1 -369098753 63 0 4129023 0;}
@font-face
	{font-family:"\@Arial Unicode MS";
	mso-font-charset:128;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-1 -369098753 63 0 4129023 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-font-kerning:16.0pt;
	font-weight:bold;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:14.0pt;
	font-family:Arial;
	font-weight:bold;
	font-style:italic;}
h3
	{mso-style-next:Normal;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:12.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h6
	{margin-right:0in;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:6;
	font-size:7.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p
	{margin-right:0in;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
code
	{mso-ascii-font-family:"Arial Unicode MS";
	mso-fareast-font-family:"Arial Unicode MS";
	mso-hansi-font-family:"Arial Unicode MS";
	mso-bidi-font-family:"Arial Unicode MS";}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1039"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
<meta name=Template content="E:\Program Files\Microsoft Office\Office\html.dot">
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<p align=center style='text-align:center'><b><span style='font-size:18.0pt'>HDF5
File Open/Create/Close Revision<o:p></o:p></span></b></p>

<p align=center style='text-align:center'>Draft revision: October 26, 2001<b><span
style='font-size:18.0pt'><o:p></o:p></span></b></p>

<h1>Revision Status</h1>

<p class=MsoNormal>Final draft candidate. Solutions for issue 1, 2 and 3a are
proposed.<span style="mso-spacerun: yes">  </span>These all involve just the
revision of the Reference Manual entries.</p>

<p class=MsoNormal>Solution for issue 3b is quite extensive and is treated in a
separated proposal.</p>

<h1>Description</h1>

<p style='margin:0in;margin-bottom:.0001pt'>The current (v1.4.2) definitions of
H5Fopen, H5Fcreate and H5Fclose (see appendix A) needs some clarification in
documentation (as in Reference Manual) and revision of library
functionalities.<span style="mso-spacerun: yes">  </span>The issues are presented
and solutions proposed below.<span style="mso-spacerun: yes">  </span>The
proposed revision are <u><span style='color:red'>underlined and in red text</span></u>.</p>

<h1>What are the issues?</h1>

<h2>Issue 1</h2>

<p class=MsoNormal>H5Fopen mentions of multiple opened file will return a
unique file identifier for each H5Fopen call but it does not say if the library
actually opens the file only once or multiple times.<span style="mso-spacerun:
yes">  </span>It also does not mention it is not always possible to detect
multiple opened file.<span style="mso-spacerun: yes">  </span>The library can
detect multiple opens of the same file in some cases such as Unix local file
systems (using major and minor devise numbers and inodes), Windows local
drive.<span style="mso-spacerun: yes">  </span>It can not detect as such if it
is a network file system (e.g., NFS) or in the case of MPI-IO access.</p>

<h3>Solution</h3>

<p class=MsoNormal>Need to revise H5Fopen with more explanation of the multiple
opened file feature.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><strong>Name:</strong> H5Fopen <span style='font-family:
"Arial Unicode MS"'><o:p></o:p></span></p>

<p class=MsoNormal><strong>Signature:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><em>hid_t </em><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fopen</span></code>(<em>const
char *</em><code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>name</span></code>,
<em>unsigned</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>flags</span></code>,
<em>hid_t</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>access_id</span></code>
) </p>

<p class=MsoNormal><strong>Purpose:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Opens an existing file. </p>

<p class=MsoNormal><strong>Description:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fopen</span></code> opens an existing file
and is the primary function for accessing existing HDF5 files. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The parameter <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code> is a file access
property list identifier or <code><span style='font-size:10.0pt;font-family:
"Arial Unicode MS"'>H5P_DEFAULT</span></code> for the default I/O access
parameters. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The <code><span style='font-size:10.0pt;font-family:
"Arial Unicode MS"'>flags</span></code> argument determines whether writing to
an existing file will be allowed or not. The file is opened with read and write
permission if <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>flags</span></code>
is set to <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_RDWR</span></code>.
All flags may be combined with the bit-wise OR operator (`|') to change the
behavior of the file open call. The more complex behaviors of a file's access
are controlled through the file-access property list. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'><u><span style='color:red'>

Multiple open of the same
file: a file which is opened more than once without closing first, will return
a unique file identifier and can be accessed through all of them.<span
style="mso-spacerun: yes">  </span>All the open calls should use the same </span></u><code><u><span
style='font-size:10.0pt;font-family:"Arial Unicode MS";color:red'>flags</span></u></code><u><span
style='color:red'> argument. In some cases such as files on a local Unix file
system, HDF5 can detect the same file is multiply opened and will maintain a
coherence accesses among all the file identifiers.<span style="mso-spacerun:
yes">  </span>But in many other cases such as parallel file systems or
networked file systems, it is not always possible to detect the multiple opens
of the same physical file.<span style="mso-spacerun: yes">  </span>In those
cases, HDF5 will treat the file identifiers as accessing different files and
cannot maintain a coherence access.<span style="mso-spacerun: yes"> 
</span>Errors are likely to result in these cases.<span style="mso-spacerun:
yes">  </span>Applications should avoid multiple open of the same file.<o:p></o:p></span></u></p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The return value is a file identifier for the open file
and it should be closed by calling <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fclose()</span></code> when it is no longer
needed. </p>

<p class=MsoNormal><strong>Parameters:</strong> </p>

<p class=MsoNormal><em>const char *</em><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>name</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>Name of the file to access. </p>

<p class=MsoNormal><em>unsigned</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>flags</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>File access flags. Allowable values
are: </p>

<p class=MsoNormal style='margin-left:1.0in'>H5F_ACC_RDWR </p>

<p class=MsoNormal style='margin-left:.5in'>Allow read and write access to
file. </p>

<p class=MsoNormal style='margin-left:1.0in'>H5F_ACC_RDONLY </p>

<p class=MsoNormal style='margin-left:.5in'>Allow read-only access to file. </p>

<p class=MsoNormal style='margin-left:.5in'><span style='mso-hansi-font-family:
Symbol'>·</span><span style="mso-spacerun: yes">  </span><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_RDWR</span></code>
and <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_RDONLY</span></code>
are mutually exclusive; use exactly one. </p>

<p class=MsoNormal style='margin-left:.5in'><span style='mso-hansi-font-family:
Symbol'>·</span><span style="mso-spacerun: yes">  </span>An additional flag, <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_DEBUG</span></code>,
prints debug information. This flag is used only by HDF5 library developers; it
is neither tested nor supported for use in applications. </p>

<p class=MsoNormal><em>hid_t</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>Identifier for the file access
properties list. If parallel file access is desired, this is a collective call
according to the communicator stored in the <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code>. Use <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5P_DEFAULT</span></code>
for default file access properties. </p>

<p class=MsoNormal><strong>Returns:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Returns a file identifier if
successful; otherwise returns a negative value. </p>

<p class=MsoNormal><strong>Non-C API(s):</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><a
href="http://hdf.ncsa.uiuc.edu/HDF5/doc/fortran/h5f_FORTRAN.html#h5fopen_f"
target=FortranWin><span style='text-decoration:none;text-underline:none'><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1025" type="#_x0000_t75" alt=""
 href="fortran\h5f_FORTRAN.html" target="FortranWin" style='width:54pt;
 height:15pt' o:button="t">
 <v:imagedata src="./file-close-proposal_files/image001.gif" o:href="http://hdf.ncsa.uiuc.edu/HDF5/doc/Graphics/FORTRAN.gif"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=72 height=20
src="./file-close-proposal_files/image001.gif" v:shapes="_x0000_i1025"><![endif]></span></a><o:p></o:p></p>

<!--
        <img src="Graphics/Java.gif"> 
        <img src="Graphics/C++.gif">
        -->

<div class=MsoNormal align=center style='text-align:center'>

<hr size=3 width="100%" align=center>

</div>


<h2>Issue 2</h2>

<p class=MsoNormal>H5Fcreate does not mention the multiple opened file
feature.<span style="mso-spacerun: yes">  </span>It does not explain what will
happen if a file is already opened, either by H5Fopen or H5Fcreate, and then
H5Fcreate is called with H5F_ACC_TRUNC.<span style="mso-spacerun: yes"> 
</span>I believe the current library will return failure if it can detect it is
a multiple open of the same file (with the same limitation as in Issue 1).<span
style="mso-spacerun: yes">  </span>If it can not detect the multiple opened
condition, it will truncate the existing file.<span style="mso-spacerun: yes"> 
</span>This is likely an error.<span style="mso-spacerun: yes">  </span>On the
other hand, this is an application error in issuing conflicting file open
requests.</p>

<h3>Solution</h3>

<h3><span style='font-weight:normal'>Need to revise H5Fcreate with more explanation
of the multiple opened file feature.<o:p></o:p></span></h3>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal align=center style='text-align:center'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><strong>Name:</strong> H5Fcreate </p>

<p class=MsoNormal><strong>Signature:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><em>hid_t </em><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fcreate</span></code>(<em>const
char *</em><code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>name</span></code>,
<em>unsigned</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>flags</span></code>,
<em>hid_t</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>create_id</span></code>,
<em>hid_t</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>access_id</span></code>
) </p>

<p class=MsoNormal><strong>Purpose:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Creates HDF5 files. </p>

<p class=MsoNormal><strong>Description:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fcreate</span></code> is the primary function
for creating HDF5 files . </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The <code><span style='font-size:10.0pt;font-family:
"Arial Unicode MS"'>flags</span></code> parameter determines whether an
existing file will be overwritten. All newly created files are opened for both
reading and writing. All flags may be combined with the bit-wise OR operator
(`|') to change the behavior of the <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fcreate</span></code> call. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The more complex behaviors of file creation and access
are controlled through the file-creation and file-access property lists. The
value of <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5P_DEFAULT</span></code>
for a property list value indicates that the library should use the default
values for the appropriate property list. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'><u><span style='color:red'>If a file being created, is
already opened by a previous H5Fopen or H5Fcreate, HDF5 may or may not detect
they are the same physical file (see H5Fopen about the limit of same file
detection). If HDF5 detects the same file is already opened, H5Fcreate returns
failure, whether H5F_ACC_TRUNC is used or not.<span style="mso-spacerun: yes"> 
</span>If HDF5 does not detect the same file is already opened and
H5F_ACC_TRUNC is not used, it will return failure </span></u><u><span
style='mso-bidi-font-family:"Courier New";color:red'>because the file already
exists</span><span style='color:red'>.<span style="mso-spacerun: yes"> 
</span>But if H5F_ACC_TRUNC is used, H5Fcreate will truncate the existing file
and returns with a valid file identifier.<span style="mso-spacerun: yes"> 
</span>Such a truncation of a currently opened file most likely result in
errors.<span style="mso-spacerun: yes">  </span>Applications should avoid
applying H5Fcreate to an already opened file.<o:p></o:p></span></u></p>

<p class=MsoNormal style='tab-stops:300.6pt'><strong>Parameters:</strong> <span
style='mso-tab-count:1'>                                                                              </span></p>

<p class=MsoNormal><em>const char *</em><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>name</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>Name of the file to access. </p>

<p class=MsoNormal><em>uintn</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>flags</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>File access flags. Allowable values
are: </p>

<p class=MsoNormal style='margin-left:1.0in'>H5F_ACC_TRUNC </p>

<p class=MsoNormal style='margin-left:.5in'>Truncate file, if it already
exists, erasing all data previously stored in the file. </p>

<p class=MsoNormal style='margin-left:1.0in'>H5F_ACC_EXCL </p>

<p class=MsoNormal style='margin-left:.5in'>Fail if file already exists. </p>

<p class=MsoNormal style='margin-left:.5in'><span style='mso-hansi-font-family:
Symbol'>·</span><span style="mso-spacerun: yes">  </span><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_TRUNC</span></code>
and <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_EXCL</span></code>
are mutually exclusive; use exactly one. </p>

<p class=MsoNormal style='margin-left:.5in'><span style='mso-hansi-font-family:
Symbol'>·</span><span style="mso-spacerun: yes">  </span>An additional flag, <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_DEBUG</span></code>,
prints debug information. This flag is used only by HDF5 library developers; <i>it
is neither tested nor supported</i> for use in applications. </p>

<p class=MsoNormal><em>hid_t</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>create_id</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>File creation property list
identifier, used when modifying default file meta-data. Use <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5P_DEFAULT</span></code>
for default file creation properties. </p>

<p class=MsoNormal><em>hid_t</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>File access property list
identifier. If parallel file access is desired, this is a collective call
according to the communicator stored in the <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code>. Use <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5P_DEFAULT</span></code>
for default file access properties. </p>

<p class=MsoNormal><strong>Returns:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Returns a file identifier if
successful; otherwise returns a negative value. </p>

<p class=MsoNormal><strong>Non-C API(s):</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><a
href="http://hdf.ncsa.uiuc.edu/HDF5/doc/fortran/h5f_FORTRAN.html#h5fcreate_f"
target=FortranWin><span style='text-decoration:none;text-underline:none'><!--[if gte vml 1]><v:shape
 id="_x0000_i1027" type="#_x0000_t75" alt="" href="fortran\h5f_FORTRAN.html"
 target="FortranWin" style='width:54pt;height:15pt' o:button="t">
 <v:imagedata src="./file-close-proposal_files/image001.gif" o:href="http://hdf.ncsa.uiuc.edu/HDF5/doc/Graphics/FORTRAN.gif"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=72 height=20
src="./file-close-proposal_files/image001.gif" v:shapes="_x0000_i1027"><![endif]></span></a><o:p></o:p></p>

<!--
        <img src="Graphics/Java.gif"> 
        <img src="Graphics/C++.gif">
        -->

<div class=MsoNormal align=center style='text-align:center'>

<hr size=3 width="100%" align=center>

</div>


<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h2>Issue 3</h2>

<p class=MsoNormal>H5Fclose promises an opened file that still has opened
objects will stay open even after H5Fclose has been called; and all open
objects can be accessed, including write.<span style="mso-spacerun: yes"> 
</span>Then when all objects of the file are closed, the file is fully
closed.<span style="mso-spacerun: yes">  </span>This is not always
possible.<span style="mso-spacerun: yes">  </span>For example, an MPI-IO file
close is a collective call.<span style="mso-spacerun: yes">  </span>Therefore
all the processes that opens the file must close the file collectively.<span
style="mso-spacerun: yes">  </span>The file can not be closed sometimes in the
future by each process in an independent fashion.<span style="mso-spacerun:
yes">  </span>Another example is that an application using AFS-token based file
access privilage may destroy its AFS-token after H5Fclose has returned
success.<span style="mso-spacerun: yes">  </span>Thus making any future access
to the file illegal.</p>

<h3>Solution</h3>

<p class=MsoNormal>a) Need to revise H5Fclose that the access to object after
H5Fclose may not always work.<span style="mso-spacerun: yes">  </span>Note that
the second paragraph of the description is redundant and should have been
removed.</p>

<p class=MsoNormal>b) Also need to revise the library code to really close the
file for the example cases mentioned above and H5Fclose should return failure
if not all objects of the file are closed. This is revision of the delay close
feature is quite extensive and is treated in a separate proposal.</p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><strong>Name:</strong> H5Fclose <span style='font-family:
"Arial Unicode MS"'><o:p></o:p></span></p>

<p class=MsoNormal><strong>Signature:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><em>herr_t </em><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fclose</span></code>(<em>hid_t</em>
<code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>file_id</span></code>
) </p>

<p class=MsoNormal><strong>Purpose:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Terminates access to an HDF5 file. </p>

<p class=MsoNormal><strong>Description:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fclose</span></code> terminates access to an
HDF5 file by flushing all data to storage and terminating access to the file
through <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>file_id</span></code>.
</p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>If this is the last file identifier open for the file
and no other access identifier is open (e.g., a dataset identifier, group
identifier, or shared datatype identifier), the file will be fully closed and
access will end. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'><strong><u><span style='color:red'>Delay close:</span></u></strong>
Note the following deviation from the above-described behavior. If <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fclose</span></code>
is called for a file but one or more objects within the file remain open, those
objects will remain accessible until they are individually closed. Thus, if the
dataset <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>data_sample</span></code>
is open when <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fclose</span></code>
is called for the file containing it, <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>data_sample</span></code> will remain open and
accessible (including writable) until it is explicitely closed. The file will
be automatically closed once all objects in the file have been closed. <u><span
style='color:red'>Be warned that it is not always possible to do delay
close.<span style="mso-spacerun: yes">  </span>For example, an MPI-IO file
close is a collective call.<span style="mso-spacerun: yes">  </span>Therefore
all the processes that opens the file must close the file collectively.<span
style="mso-spacerun: yes">  </span>The file can not be closed sometimes in the
future by each process in an independent fashion.<span style="mso-spacerun:
yes">  </span>Another example is that an application using AFS-token based file
access privilage may destroy its AFS-token after H5Fclose has returned
success.<span style="mso-spacerun: yes">  </span>Thus making any future access
to the file illegal. Applications should close all open objects of a file
before calling </span></u><code><u><span style='font-size:10.0pt;font-family:
"Arial Unicode MS";color:red'>H5Fclose.</span></u></code><u><span
style='color:red'> <o:p></o:p></span></u></p>

<p class=MsoNormal><strong>Parameters:</strong> </p>

<p class=MsoNormal><em>hid_t</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>file_id</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>Identifier of a file to terminate
access to. </p>

<p class=MsoNormal><strong>Returns:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Returns a non-negative value if
successful; otherwise returns a negative value. </p>

<p class=MsoNormal><strong>Non-C API(s):</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><a
href="http://hdf.ncsa.uiuc.edu/HDF5/doc/fortran/h5f_FORTRAN.html#h5fclose_f"
target=FortranWin><span style='text-decoration:none;text-underline:none'><!--[if gte vml 1]><v:shape
 id="_x0000_i1029" type="#_x0000_t75" alt="" href="fortran\h5f_FORTRAN.html"
 target="FortranWin" style='width:54pt;height:15pt' o:button="t">
 <v:imagedata src="./file-close-proposal_files/image001.gif" o:href="http://hdf.ncsa.uiuc.edu/HDF5/doc/Graphics/FORTRAN.gif"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=72 height=20
src="./file-close-proposal_files/image001.gif" v:shapes="_x0000_i1029"><![endif]></span></a><o:p></o:p></p>

<!--
        <img src="Graphics/Java.gif"> 
        <img src="Graphics/C++.gif">
        -->

<div class=MsoNormal align=center style='text-align:center'>

<hr size=3 width="100%" align=center>

</div>


<h1>Appendix A: Current v1.4.2 definitions of H5Fopen/H5Fcreate/H5Fclose</h1>

<p class=MsoNormal><strong><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></strong></p>

<p class=MsoNormal><strong>Name:</strong> H5Fopen <span style='font-family:
"Arial Unicode MS"'><o:p></o:p></span></p>

<p class=MsoNormal><strong>Signature:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><em>hid_t </em><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fopen</span></code>(<em>const
char *</em><code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>name</span></code>,
<em>unsigned</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>flags</span></code>,
<em>hid_t</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>access_id</span></code>
) </p>

<p class=MsoNormal><strong>Purpose:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Opens an existing file. </p>

<p class=MsoNormal><strong>Description:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fopen</span></code> opens an existing file
and is the primary function for accessing existing HDF5 files. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The parameter <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code> is a file access
property list identifier or <code><span style='font-size:10.0pt;font-family:
"Arial Unicode MS"'>H5P_DEFAULT</span></code> for the default I/O access
parameters. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The <code><span style='font-size:10.0pt;font-family:
"Arial Unicode MS"'>flags</span></code> argument determines whether writing to
an existing file will be allowed or not. The file is opened with read and write
permission if <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>flags</span></code>
is set to <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_RDWR</span></code>.
All flags may be combined with the bit-wise OR operator (`|') to change the
behavior of the file open call. The more complex behaviors of a file's access
are controlled through the file-access property list. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>Files which are opened more than once return a unique
identifier for each <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fopen()</span></code>
call and can be accessed through all file identifiers. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The return value is a file identifier for the open file
and it should be closed by calling <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fclose()</span></code> when it is no longer
needed. </p>

<p class=MsoNormal><strong>Parameters:</strong> </p>

<p class=MsoNormal><em>const char *</em><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>name</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>Name of the file to access. </p>

<p class=MsoNormal><em>unsigned</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>flags</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>File access flags. Allowable values
are: </p>

<p class=MsoNormal style='margin-left:1.0in'>H5F_ACC_RDWR </p>

<p class=MsoNormal style='margin-left:.5in'>Allow read and write access to
file. </p>

<p class=MsoNormal style='margin-left:1.0in'>H5F_ACC_RDONLY </p>

<p class=MsoNormal style='margin-left:.5in'>Allow read-only access to file. </p>

<p class=MsoNormal style='margin-left:.5in'><span style='mso-hansi-font-family:
Symbol'>·</span><span style="mso-spacerun: yes">  </span><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_RDWR</span></code>
and <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_RDONLY</span></code>
are mutually exclusive; use exactly one. </p>

<p class=MsoNormal style='margin-left:.5in'><span style='mso-hansi-font-family:
Symbol'>·</span><span style="mso-spacerun: yes">  </span>An additional flag, <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_DEBUG</span></code>,
prints debug information. This flag is used only by HDF5 library developers; it
is neither tested nor supported for use in applications. </p>

<p class=MsoNormal><em>hid_t</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>Identifier for the file access
properties list. If parallel file access is desired, this is a collective call
according to the communicator stored in the <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code>. Use <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5P_DEFAULT</span></code>
for default file access properties. </p>

<p class=MsoNormal><strong>Returns:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Returns a file identifier if
successful; otherwise returns a negative value. </p>

<p class=MsoNormal><strong>Non-C API(s):</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><a
href="http://hdf.ncsa.uiuc.edu/HDF5/doc/fortran/h5f_FORTRAN.html#h5fopen_f"
target=FortranWin><span style='text-decoration:none;text-underline:none'><!--[if gte vml 1]><v:shape
 id="_x0000_i1031" type="#_x0000_t75" alt="" href="fortran\h5f_FORTRAN.html"
 target="FortranWin" style='width:54pt;height:15pt' o:button="t">
 <v:imagedata src="./file-close-proposal_files/image001.gif" o:href="http://hdf.ncsa.uiuc.edu/HDF5/doc/Graphics/FORTRAN.gif"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=72 height=20
src="./file-close-proposal_files/image001.gif" v:shapes="_x0000_i1031"><![endif]></span></a><o:p></o:p></p>

<!--
        <img src="Graphics/Java.gif"> 
        <img src="Graphics/C++.gif">
        -->

<div class=MsoNormal align=center style='text-align:center'>

<hr size=3 width="100%" align=center>

</div>


<p class=MsoNormal><strong>Name:</strong> H5Fcreate </p>

<p class=MsoNormal><strong>Signature:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><em>hid_t </em><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fcreate</span></code>(<em>const
char *</em><code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>name</span></code>,
<em>unsigned</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>flags</span></code>,
<em>hid_t</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>create_id</span></code>,
<em>hid_t</em> <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>access_id</span></code>
) </p>

<p class=MsoNormal><strong>Purpose:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Creates HDF5 files. </p>

<p class=MsoNormal><strong>Description:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fcreate</span></code> is the primary function
for creating HDF5 files . </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The <code><span style='font-size:10.0pt;font-family:
"Arial Unicode MS"'>flags</span></code> parameter determines whether an existing
file will be overwritten. All newly created files are opened for both reading
and writing. All flags may be combined with the bit-wise OR operator (`|') to
change the behavior of the <code><span style='font-size:10.0pt;font-family:
"Arial Unicode MS"'>H5Fcreate</span></code> call. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>The more complex behaviors of file creation and access
are controlled through the file-creation and file-access property lists. The
value of <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5P_DEFAULT</span></code>
for a property list value indicates that the library should use the default
values for the appropriate property list. </p>

<p class=MsoNormal><strong>Parameters:</strong> </p>

<p class=MsoNormal><em>const char *</em><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>name</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>Name of the file to access. </p>

<p class=MsoNormal><em>uintn</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>flags</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>File access flags. Allowable values
are: </p>

<p class=MsoNormal style='margin-left:1.0in'>H5F_ACC_TRUNC </p>

<p class=MsoNormal style='margin-left:.5in'>Truncate file, if it already
exists, erasing all data previously stored in the file. </p>

<p class=MsoNormal style='margin-left:1.0in'>H5F_ACC_EXCL </p>

<p class=MsoNormal style='margin-left:.5in'>Fail if file already exists. </p>

<p class=MsoNormal style='margin-left:.5in'><span style='mso-hansi-font-family:
Symbol'>·</span><span style="mso-spacerun: yes">  </span><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_TRUNC</span></code>
and <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_EXCL</span></code>
are mutually exclusive; use exactly one. </p>

<p class=MsoNormal style='margin-left:.5in'><span style='mso-hansi-font-family:
Symbol'>·</span><span style="mso-spacerun: yes">  </span>An additional flag, <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5F_ACC_DEBUG</span></code>,
prints debug information. This flag is used only by HDF5 library developers; <i>it
is neither tested nor supported</i> for use in applications. </p>

<p class=MsoNormal><em>hid_t</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>create_id</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>File creation property list
identifier, used when modifying default file meta-data. Use <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5P_DEFAULT</span></code>
for default file creation properties. </p>

<p class=MsoNormal><em>hid_t</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>File access property list
identifier. If parallel file access is desired, this is a collective call according
to the communicator stored in the <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>access_id</span></code>. Use <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5P_DEFAULT</span></code>
for default file access properties. </p>

<p class=MsoNormal><strong>Returns:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Returns a file identifier if
successful; otherwise returns a negative value. </p>

<p class=MsoNormal><strong>Non-C API(s):</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><a
href="http://hdf.ncsa.uiuc.edu/HDF5/doc/fortran/h5f_FORTRAN.html#h5fcreate_f"
target=FortranWin><span style='text-decoration:none;text-underline:none'><!--[if gte vml 1]><v:shape
 id="_x0000_i1033" type="#_x0000_t75" alt="" href="fortran\h5f_FORTRAN.html"
 target="FortranWin" style='width:54pt;height:15pt' o:button="t">
 <v:imagedata src="./file-close-proposal_files/image001.gif" o:href="http://hdf.ncsa.uiuc.edu/HDF5/doc/Graphics/FORTRAN.gif"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=72 height=20
src="./file-close-proposal_files/image001.gif" v:shapes="_x0000_i1033"><![endif]></span></a><o:p></o:p></p>

<!--
        <img src="Graphics/Java.gif"> 
        <img src="Graphics/C++.gif">
        -->

<div class=MsoNormal align=center style='text-align:center'>

<hr size=3 width="100%" align=center>

</div>


<p class=MsoNormal><strong>Name:</strong> H5Fclose <span style='font-family:
"Arial Unicode MS"'><o:p></o:p></span></p>

<p class=MsoNormal><strong>Signature:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><em>herr_t </em><code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fclose</span></code>(<em>hid_t</em>
<code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>file_id</span></code>
) </p>

<p class=MsoNormal><strong>Purpose:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Terminates access to an HDF5 file. </p>

<p class=MsoNormal><strong>Description:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fclose</span></code> terminates access to an
HDF5 file by flushing all data to storage and terminating access to the file
through <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>file_id</span></code>.
</p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>If this is the last file identifier open for the file
and no other access identifier is open (e.g., a dataset identifier, group
identifier, or shared datatype identifier), the file will be fully closed and
access will end. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'>If this is the last file identifier open for the file
and other access identifiers are still in use, those access identifiers remain valid
until separately closed and can still be used. (But the file identifier is no
longer valid and cannot be used.) Once all of the remaining access identifiers
are closed, the file will be fully closed and access will end. </p>

<p style='margin-top:0in;margin-right:0in;margin-bottom:0in;margin-left:.5in;
margin-bottom:.0001pt'><strong>EXCEPTION:</strong> Note the following deviation
from the above-described behavior. If <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>H5Fclose</span></code> is called for a file but
one or more objects within the file remain open, those objects will remain
accessible until they are individually closed. Thus, if the dataset <code><span
style='font-size:10.0pt;font-family:"Arial Unicode MS"'>data_sample</span></code>
is open when <code><span style='font-size:10.0pt;font-family:"Arial Unicode MS"'>H5Fclose</span></code>
is called for the file containing it, <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>data_sample</span></code> will remain open and
accessible (including writable) until it is explicitely closed. The file will
be automatically closed once all objects in the file have been closed. </p>

<p class=MsoNormal><strong>Parameters:</strong> </p>

<p class=MsoNormal><em>hid_t</em> <code><span style='font-size:10.0pt;
font-family:"Arial Unicode MS"'>file_id</span></code> </p>

<p class=MsoNormal style='margin-left:.5in'>Identifier of a file to terminate
access to. </p>

<p class=MsoNormal><strong>Returns:</strong> </p>

<p class=MsoNormal style='margin-left:.5in'>Returns a non-negative value if
successful; otherwise returns a negative value. </p>

<p class=MsoNormal><strong>Non-C API(s):</strong> </p>

<p class=MsoNormal style='margin-left:.5in'><a
href="http://hdf.ncsa.uiuc.edu/HDF5/doc/fortran/h5f_FORTRAN.html#h5fclose_f"
target=FortranWin><span style='text-decoration:none;text-underline:none'><!--[if gte vml 1]><v:shape
 id="_x0000_i1035" type="#_x0000_t75" alt="" href="fortran\h5f_FORTRAN.html"
 target="FortranWin" style='width:54pt;height:15pt' o:button="t">
 <v:imagedata src="./file-close-proposal_files/image001.gif" o:href="http://hdf.ncsa.uiuc.edu/HDF5/doc/Graphics/FORTRAN.gif"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=72 height=20
src="./file-close-proposal_files/image001.gif" v:shapes="_x0000_i1035"><![endif]></span></a><o:p></o:p></p>

<!--
        <img src="Graphics/Java.gif"> 
        <img src="Graphics/C++.gif">
        -->

<div class=MsoNormal align=center style='text-align:center'>

<hr size=3 width="100%" align=center>

</div>


<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal>Last revision: Albert Cheng, October 26, 2001</p>

<p class=MsoNormal>Email: hdf5lib@ncsa.uiuc.edu</p>

</div>

</body>

</html>
