
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 

\section{Introduction}

\section{Quickstart}

\subsection*{Read The Documentation For The New VOL Connector}

Many VOL connectors will require specific setup and configuration of both the application and the storage. Specific permissions may have to be set, configuration files constructed, and connector-specific setup calls may need to be invoked in the application. In many cases, converting software to use a new VOL connector will be more than just a straightforward drop-in replacement done by specifying a name in the VOL plugin environment variable.

\subsection*{Use A VOL-Enabled HDF5 Library}

The virtual object layer was introduced in HDF5 1.12.0, so you will need that version or later to use it. The particular configuration of the library (serial vs parallel, thread-safe, debug vs production/release) does not matter. The VOL is a fundamental part of the library and cannot be disabled, so any build will do.

On Windows, it's probably best to use the same debug vs release configuration for the application and all libraries in order to avoid C runtime (CRT) issues. On pre-2015 versions of Visual Studio, you'll probably also want to stick to the same Visual Studio version (and thus same CRT version) as well.

When working with a debug HDF5 library, it's probably also wise to build with the "memory sanity checking" feature disabled to avoid accidentally clobbering our memory tracking infrastructure when dealing with buffers obtained from the HDF5 library.

\subsection*{Make Sure The VOL Connector Is In The Search Path}

The default location for all HDF5 plugins is set at configure time when building the HDF5 library. This is true for both CMake and the Autotools.

\textbf{Default locations:}

\begin{tabular}{ l l }
    POSIX systems: &  {\tt /usr/local/hdf5/lib/plugin} \\
     & \\
    Windows: & {\tt \%ALLUSERSPROFILE\%/hdf5/lib/plugin}
\end{tabular}

These default locations can be overridden by setting the {\tt HDF5\_PLUGIN\_PATH} environment variable. There are also public {\tt H5PL} API calls which can be used to add, modify, and remove search paths. The library will only look for plugins in the specified plugin paths. By default, it will NOT find plugins that are simply located in the same directory as the executable.

\subsection*{Update Your Code To Load And Use A VOL Connector}

How this is done depends on the VOL connector, which may have special API calls for setup or require appropriate configuration files, but the most generic way to modify a program to use a specific VOL connector would be to {\tt use H5Pset\_vol()} to set the VOL connector in the file access property list (fapl) that will be used to open the file.

You will also need to protect any API calls which are only implemented in the native VOL connector as those calls will fail when using a non-native VOL connector. See the section entitled "Adapting HDF5 Software to Use the VOL", below. A list of native VOL API calls has been included in an appendix.

\subsection*{Optional: Set The VOL Connector Via The Environment Variable}


\section{Loading and Registering Connectors}
\subsection{VOL Connector Search Path}
\subsection{Connector Versioning}
\subsection{Connector-Specific Registration Calls}
\subsection{\tt H5Pset\_vol()}
\subsection{Connector Compatibility}

\thgfuturewarning


\subsection{Connection Strings}
\subsection{Environment Variable}

The HDF5 library allows specifying a default VOL connector via an environment variable: {\tt HDF5\_VOL\_CONNECTOR}. The value of this environment variable should be set to "\textit{vol\_connector\_name $<$parameters$>$}".

This will perform the equivalent of:

\begin{enumerate}
    \item {\tt H5VLregister\_connector\_by\_name()} using the specified connector name
    \item {\tt H5VLconnector\_str\_to\_info()} using the specified parameters. This will go through the connector we got from the previous step and should return a VOL info struct from the parameter string in the environment variable.
    \item {\tt H5Pset\_vol()} on the default fapl using the obtained ID and info.
\end{enumerate}

The environment variable is parsed once, at library startup. Since the environment variable scheme just changes the default connector, it can be overridden by subsequent calls to {\tt H5Pset\_vol()}. The \textit{$<$parameters$>$} is optional, so for connectors which do not require any special configuration parameters you can just set the environment variable to the name.

\section{Adapting HDF5 Software to Use the VOL}

\subsection{Specific API Call Substitutions}
\subsection*{${\tt H5Fis\_hdf5()} \rightarrow {\tt H5Fis\_accessible()}$}

{\tt H5Fis\_hdf5()} does not take a file access property list (fapl). As this is where the VOL connector is specified, this call cannot be used with aribtrary connectors. As a VOL-enabled replacement, {\tt H5Fis\_accessible()} has been added to the library. It has the same semantics as {\tt H5Fis\_hdf5()}, but takes a fapl so it can work with any VOL connector.

Note that, at this time, {\tt H5Fis\_hdf5()} \textit{always} uses the native VOL connector, regardless of the settings of environment variables, etc.

\subsection*{${\tt H5Oget\_info[1|2]()} \rightarrow {\tt H5Ofuture\_function\_goes\_here()}$}

\thgfuturewarning

The {\tt H5Oget\_info1()} and {\tt H5Oget\_info2()} are often used by user code to obtain information about an object in the file, however these calls return a struct which contains native information and are thus currently handled via the native connector's \textit{object optional} callback.

These calls will be separated into two functions: one for getting generic object info (which will go through the \textit{object get} callback), and another for returning native file format information (which will go through the native connector's \textit{object optional} callback).

\subsection{Protect Native-Only API Calls}



\section{Using VOL Connectors With The HDF5 Command-Line Tools}

\section{Compatibility}
\subsection{Feature Flags}
\thgfuturewarning
\subsection{List of HDF5 Native VOL API Calls}

These API calls will probably fail when used with terminal VOL connectors other than the native HDF5 file format connector. Their use should be protected in code that uses arbitrary VOL connectors.
\begin{longtable}{ |>{\raggedright\arraybackslash}p{\linewidth}| }
    \hline
    H5Aget\_num\_attrs (deprecated) \\
    H5Aiterate1 (deprecated) \\
    \hline
    H5Ddebug \\
    H5Dformat\_convert \\
    H5Dget\_chunk\_index\_type \\
    H5Dget\_chunk\_info \\
    H5Dget\_chunk\_info\_by\_coord \\
    H5Dget\_chunk\_storage\_size \\
    H5Dget\_num\_chunks \\
    H5Dread\_chunk H5Dwrite\_chunk \\
    \hline
    H5FD* \\
    \hline
    H5Fclear\_elink\_file\_cache \\
    H5Fformat\_convert \\
    H5Fget\_dset\_no\_attrs\_hint \\
    H5Fget\_eoa H5Fget\_file\_image \\
    H5Fget\_filesize \\
    H5Fget\_free\_sections \\
    H5Fget\_freespace \\
    H5Fget\_info1 (deprecated) \\
    H5Fget\_info2 \\
    H5Fget\_mdc\_config \\
    H5Fget\_mdc\_hit\_rate \\
    H5Fget\_mdc\_image\_info \\
    H5Fget\_mdc\_logging\_status \\
    H5Fget\_mdc\_size \\
    H5Fget\_metadata\_read\_retry\_info \\
    H5Fget\_mpi\_atomicity \\
    H5Fget\_page\_buffering\_stats \\
    H5Fget\_vfd\_handle \\
    H5Fincrement\_filesize \\
    H5Fis\_hdf5 (deprecated) \\
    H5Freset\_mdc\_hit\_rate\_stats \\
    H5Freset\_page\_buffering\_stats \\
    H5Fset\_dset\_no\_attrs\_hint \\
    H5Fset\_latest\_format (deprecated) \\
    H5Fset\_libver\_bounds \\
    H5Fset\_mdc\_config \\
    H5Fset\_mpi\_atomicity \\
    H5Fstart\_mdc\_logging \\
    H5Fstart\_swmr\_write \\
    H5Fstop\_mdc\_logging \\
    \hline
    H5Gget\_comment (deprecated) \\
    H5Giterate (deprecated) \\
    H5Gget\_info \\
    H5Gget\_info\_by\_name \\
    H5Gget\_info\_by\_idx \\
    H5Gget\_objinfo (deprecated) \\
    H5Gget\_objname\_by\_idx (deprecated) \\
    H5Gget\_objtype\_by\_idx (deprecated) \\
    H5Gset\_comment (deprecated) \\
    \hline
    H5Oare\_mdc\_flushes\_disabled \\
    H5Odisable\_mdc\_flushes \\
    H5Oenable\_mdc\_flushes \\
    H5Oget\_comment \\
    H5Oget\_comment\_by\_name \\
    H5Oget\_info\_by\_idx1 (deprecated) \\
    H5Oget\_info\_by\_idx2 \\
    H5Oget\_info\_by\_name1 (deprecated) \\
    H5Oget\_info\_by\_name2 \\
    H5Oget\_info1 (deprecated) \\
    H5Oget\_info2 \\
    H5Oset\_comment \\
    H5Oset\_comment\_by\_name \\
    \hline
\caption{Alphabetical list of HDF5 API calls specific to the native VOL connector}
\end{longtable}

\subsection{List of HDF5 VOL-Independent API Calls}

These HDF5 API calls do not depend on a particular VOL connector being loaded.

\begin{longtable}{ |>{\raggedright\arraybackslash}p{\linewidth}| }
    \hline
    H5* \\
    \hline
    H5Dfill \\
    H5Dgather \\
    H5Diterate \\
    H5Dscatter \\
    H5Dvlen\_reclaim (deprecated) \\
    H5Dvlen\_get\_buf\_size \\
    \hline
    H5E* \\
    H5I* \\
    \hline
    H5Lis\_registered \\
    H5Lregister \\
    H5Lunpack\_elink\_val \\
    H5Lunregister \\
    \hline
    H5PL* \\
    H5P* \\
    H5S* \\
    H5T* (non-committed) \\
    H5VL* \\
    H5Z* \\
    \hline
\caption{Alphabetical list of VOL-independent HDF5 API calls}
\end{longtable}

\subsection{List of HDF5 API Calls By Callback}

\begin{longtable}{ |l|>{\raggedright\arraybackslash}l| }
    \hline
    \multicolumn{1}{|c|}{VOL Callback} & \multicolumn{1}{|c|}{HDF5 API Call} \\
    \hline
    \multicolumn{2}{|>{\raggedright\arraybackslash}p{\linewidth}|}{\cellcolor{gray!35}FILE} \\
    \hline
    create & H5Fcreate \\
    \hline
    open & H5Fopen \\
    \hline
    get & H5Fget\_access\_plist \\
        & H5Fget\_create\_plist \\
        & H5Fget\_fileno \\
        & H5Fget\_intent \\
        & H5Fget\_name \\
        & H5Fget\_obj\_count \\
        & H5Fget\_obj\_ids \\
    \hline
    specific & H5Fdelete \\
             & H5Fflush \\
             & H5Fis\_accessible \\
             & H5Fis\_hdf5 (deprecated, hard-coded to use native connector) \\
             & H5Fmount \\
             & H5Freopen \\
             & H5Funmount \\
    \hline
    close & H5Fclose \\
    \hline
    \multicolumn{2}{|>{\raggedright\arraybackslash}p{\linewidth}|}{\cellcolor{gray!35}GROUP} \\
    \hline
    create & H5Gcreate1 (deprecated) \\
           & H5Gcreate2 \\
           & H5Gcreate\_anon \\
    \hline
    open & H5Gopen1 (deprecated) \\
         & H5Gopen2 \\
    \hline
    get & H5Gget\_create\_plist \\
        & H5Gget\_info \\
        & H5Gget\_info\_by\_idx \\
        & H5Gget\_info\_by\_name \\
        & H5Gget\_num\_objs (deprecated) \\
    \hline
    specific & H5Gflush \\
             & H5Grefresh \\
    \hline
    close & H5Gclose \\
    \hline
    \multicolumn{2}{|>{\raggedright\arraybackslash}p{\linewidth}|}{\cellcolor{gray!35}DATASET} \\
    \hline
    create & H5Dcreate1 (deprecated) \\
           & H5Dcreate2 \\
    \hline
    open & H5Dopen1 (deprecated) \\
         & H5Dopen2 \\
    \hline
    read & H5Dread \\
    \hline
    write & H5Dwrite \\
    \hline
    get & H5Dget\_access\_plist \\
        & H5Dget\_create\_plist \\
        & H5Dextend \\
        & H5Dget\_offset \\
        & H5Dget\_space \\
        & H5Dget\_space\_status \\
        & H5Dget\_storage\_size \\
        & H5Dget\_type \\
    \hline
    specific & H5Dextend (deprecated) \\
             & H5Dflush \\
             & H5Drefresh \\
             & H5Dset\_extent \\
    \hline
    close & H5Dclose \\
    \hline
    \multicolumn{2}{|>{\raggedright\arraybackslash}p{\linewidth}|}{\cellcolor{gray!35}OBJECT} \\
    \hline
    open & H5Oopen \\
         & H5Oopen\_by\_addr \\
         & H5Oopen\_by\_idx \\
         & H5Oopen\_by\_name \\
    \hline
    copy & H5Ocopy \\
    \hline
    get & N/A \\
    \hline
    specific & H5Odecr\_refcount \\
             & H5Oexists\_by\_name \\
             & H5Oflush \\
             & H5O\_incr\_refcount \\
             & H5Orefresh \\
             & H5Ovisit\_by\_name1 (deprecated) \\
             & H5Ovisit\_by\_name2 \\
             & H5Ovisit1 (deprecated) \\
             & H5Ovisit2 \\
    \hline
    close & H5Oclose \\
    \hline
    \multicolumn{2}{|>{\raggedright\arraybackslash}p{\linewidth}|}{\cellcolor{gray!35}LINK} \\
    \hline
    create & H5Glink (deprecated) \\
           & H5Glink2 (deprecated) \\
           & H5Lcreate\_hard \\
           & H5Lcreate\_soft \\
           & H5Lcreate\_ud \\
           & H5Olink \\
    \hline
    copy & H5Lcopy \\
    \hline
    move & H5Gmove (deprecated) \\
         & H5Gmove2 (deprecated) \\
         & H5Lmove \\
    \hline
    get & H5Gget\_linkval (deprecated) \\
        & H5Lget\_info \\
        & H5Lget\_info\_by\_idx \\
        & H5Lget\_name\_by\_idx \\
        & H5Lget\_val \\
        & H5Lget\_val\_by\_idx \\
    \hline
    specific & H5Gunlink (deprecated) \\
             & H5Ldelete \\
             & H5Ldelete\_by\_idx \\
             & H5Lexists \\
             & H5Literate \\
             & H5Literate\_by\_name \\
             & H5Lvisit \\
             & H5Lvisit\_by\_name \\
    \hline
    \multicolumn{2}{|>{\raggedright\arraybackslash}p{\linewidth}|}{\cellcolor{gray!35}DATATYPE} \\
    \hline
    commit & H5Tcommit1 (deprecated) \\
           & H5Tcommit2 \\
           & H5Tcommit\_anon \\
    \hline
    open & H5Topen1 (deprecated) \\
         & H5Topen2 \\
    \hline
    get & H5Tget\_create\_plist \\
    \hline
    specific & H5Tflush \\
             & H5Trefresh \\
    \hline
    close & H5Tclose \\
    \hline
    \multicolumn{2}{|>{\raggedright\arraybackslash}p{\linewidth}|}{\cellcolor{gray!35}ATTRIBUTE} \\
    \hline
    create & H5Acreate1 (deprecated) \\
           & H5Acreate2 \\
           & H5Acreate\_by\_name \\
    \hline
    open & H5Aopen \\
         & H5Aopen\_by\_idx \\
         & H5Aopen\_by\_name \\
         & H5Aopen\_idx (deprecated)\\
         & H5Aopen\_name (deprecated) \\
    \hline
    read & H5Aread \\
    \hline
    write & H5Awrite \\
    \hline
    get & H5Aget\_get\_create\_plist \\
        & H5Aget\_info \\
        & H5Aget\_info\_by\_idx \\
        & H5Aget\_info\_by\_name \\
        & H5Aget\_name \\
        & H5Aget\_name\_by\_idx \\
        & H5Aget\_space \\
        & H5Aget\_storage\_size \\
        & H5Aget\_type \\
    \hline
    specific & H5Adelete \\
             & H5Adelete\_by\_idx \\
             & H5Adelete\_by\_name \\
             & H5Aexists \\
             & H5Aexists\_by\_name \\
             & H5Aiterate1 (deprecated) \\
             & H5Aiterate2 \\
             & H5Aiterate\_by\_name \\
             & H5Arename \\
             & H5Arename\_by\_name \\
    \hline
    close & H5Aclose \\
    \hline
\caption{Breakdown of HDF5 API calls by VOL callback}
\end{longtable}


